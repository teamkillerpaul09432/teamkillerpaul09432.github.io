<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
</head>
<body>
  <h2>Login</h2>
  <input type="file" id="userfile" accept=".json"><br><br>
  <input type="text" id="username" placeholder="Benutzername"><br>
  <input type="password" id="password" placeholder="Passwort"><br>
  <button onclick="login()">Anmelden</button>
  <p id="msg" style="color: red;"></p>
<script>
let loadedUsers = [
  {
    username: "admin",
    password: "Paul2009",
    rank: "admin"
  }
];

// Nutzerdatei kann zusätzlich geladen werden
document.getElementById('userfile').addEventListener('change', function () {
  const reader = new FileReader();
  reader.onload = function (e) {
    try {
      const fileUsers = JSON.parse(e.target.result);
      if (Array.isArray(fileUsers)) {
        loadedUsers = fileUsers;
        document.getElementById("msg").innerText = "Benutzerdaten geladen.";
      } else {
        throw new Error();
      }
    } catch {
      document.getElementById("msg").innerText = "Ungültige Datei!";
    }
  };
  reader.readAsText(this.files[0]);
});

function login() {
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;
  const found = loadedUsers.find(u => u.username === user && u.password === pass);

  if (found) {
    localStorage.setItem("isLoggedIn", "true");
    localStorage.setItem("username", found.username);
    localStorage.setItem("rank", found.rank);
    window.location.href = "index.html";
  } else {
    document.getElementById("msg").innerText = "Falscher Benutzername oder Passwort!";
  }
}
</script>
</body>
</html>
